<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comparador de Canasta con JSON e Íconos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    th, td { text-align: center; vertical-align: middle; }
    .resaltado-uy { background-color: #d1e7dd !important; }
    .resaltado-br { background-color: #cff4fc !important; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="text-center mb-4">🛍️ Comparador de Canasta Básica 🇺🇾 vs 🇧🇷 (JSON)</h2>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <label><strong>💱 1 <span class="fw-bold">🇧🇷</span> = </strong></label>
        <input type="number" id="valorReal" value="8.00" step="0.01" class="form-control d-inline w-auto">
        <span class="ms-1"><span class="fw-bold">🇺🇾</span></span>
      </div>
      <button class="btn btn-primary" onclick="comparar()">📈 Comparar</button>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover" id="tabla">
        <thead class="table-dark">
          <tr>
            <th>✔️</th>
            <th>Producto</th>
            <th>🇺🇾</th>
            <th>🇧🇷</th>
            <th>🇧🇷 en 🇺🇾</th>
            <th>Más conveniente</th>
            <th>Cant.</th>
          </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
      </table>
    </div>

    <div class="text-center">
      <button class="btn btn-warning" onclick="calcular()">🧮 Simular compra</button>
    </div>

    <div class="row text-center mt-3">
      <div class="col-md-6"><div class="alert alert-success" id="totalUy">🇺🇾 Total: 0</div></div>
      <div class="col-md-6"><div class="alert alert-info" id="totalBr">🇧🇷 Total: 0</div></div>
    </div>
  </div>

<script>
let datos = [];

fetch('canasta.json')
  .then(res => res.json())
  .then(json => {
    datos = json;
    const cuerpo = document.getElementById('cuerpoTabla');
    datos.forEach((item, i) => {
      const fila = document.createElement('tr');
      fila.innerHTML = `
        <td><input type="checkbox" class="form-check-input selector"></td>
        <td>${item.producto}</td>
        <td><input type="number" class="form-control uy" value="${item.precio_uy}"></td>
        <td><input type="number" class="form-control br" value="${item.precio_br}"></td>
        <td class="br-conv"></td>
        <td class="mejor-opcion fw-bold"></td>
        <td><input type="number" class="form-control cantidad" value="${item.cantidad}"></td>
      `;
      cuerpo.appendChild(fila);
    });
  });

function comparar() {
  const filas = document.querySelectorAll('#tabla tbody tr');
  const valorReal = parseFloat(document.getElementById('valorReal').value);
  filas.forEach(fila => {
    const uy = parseFloat(fila.querySelector('.uy').value) || 0;
    const br = parseFloat(fila.querySelector('.br').value) || 0;
    const brEnUy = br * valorReal;

    fila.querySelector('.br-conv').innerText = `🇺🇾 ${brEnUy.toFixed(2)}`;
    const celdaMejor = fila.querySelector('.mejor-opcion');
    fila.classList.remove('resaltado-uy', 'resaltado-br');

    if (uy < brEnUy) {
      celdaMejor.innerText = '🇺🇾';
      fila.classList.add('resaltado-uy');
    } else if (brEnUy < uy) {
      celdaMejor.innerText = '🇧🇷';
      fila.classList.add('resaltado-br');
    } else {
      celdaMejor.innerText = '🎯';
    }
  });
}

function calcular() {
  const filas = document.querySelectorAll('#tabla tbody tr');
  let totalUy = 0, totalBr = 0;
  filas.forEach(fila => {
    if (!fila.querySelector('.selector').checked) return;
    const uy = parseFloat(fila.querySelector('.uy').value) || 0;
    const br = parseFloat(fila.querySelector('.br').value) || 0;
    const cantidad = parseFloat(fila.querySelector('.cantidad').value) || 1;
    totalUy += uy * cantidad;
    totalBr += br * cantidad;
  });
  document.getElementById('totalUy').innerText = `🇺🇾 Total: ${totalUy.toFixed(2)}`;
  document.getElementById('totalBr').innerText = `🇧🇷 Total: ${totalBr.toFixed(2)}`;
}
</script>
</body>
</html>
