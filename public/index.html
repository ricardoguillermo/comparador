<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Comparador Canasta con Im√°genes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      th,
      td {
        text-align: center;
        vertical-align: middle;
      }
      .resaltado-uy {
        background-color: #d1e7dd !important;
      }
      .resaltado-br {
        background-color: #cff4fc !important;
      }
      .br-conv {
        font-weight: bold;
        color: blue;
      }

      .mejor-opcion {
        font-size: 1.5rem;
      }

      img.icono {
        width: 24px;
        vertical-align: middle;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h2 class="text-center mb-4">
        üõçÔ∏è Comparador de Canasta B√°sica
        <img src="img/uy.png" class="icono" /> vs
        <img src="img/br.png" class="icono" />
      </h2>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <label
            ><strong
              >üí± 1 <img src="img/br.png" class="icono" /> =
            </strong></label
          >
          <input
            type="number"
            id="valorReal"
            value="8.00"
            step="0.01"
            class="form-control d-inline w-25"
          />
          <span class="ms-1"><img src="img/uy.png" class="icono" /></span>
        </div>
        <button class="btn btn-primary" onclick="comparar()">
          üìà Comparar
        </button>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered table-hover" id="tabla">
          <thead class="table-dark">
            <tr>
              <th>‚úîÔ∏è</th>
              <th>Producto</th>
              <th><img src="img/uy.png" class="icono" /></th>
              <th><img src="img/br.png" class="icono" /></th>
              <th>
                <img src="img/br.png" class="icono" /> en
                <img src="img/uy.png" class="icono" />
              </th>
              <!-- <th>
                <img src="public/img/br.png" class="icono" /> en
                <img src="public/img/uy.png" class="icono" />
              </th>
 -->
              <!-- <th>M√°s conveniente</th> -->
              <th>Cant.</th>
            </tr>
          </thead>
          <tbody id="cuerpoTabla"></tbody>
        </table>
      </div>

      <div class="text-center">
        <button class="btn btn-warning" onclick="calcular()">
          üßÆ Simular compra
        </button>
      </div>

      <div class="row text-center mt-3">
        <div class="col-md-6">
          <div class="alert alert-success" id="totalUy">
            <img src="img/uy.png" class="icono" /> Total: 0
          </div>
        </div>
        <div class="col-md-6">
          <div class="alert alert-info" id="totalBr">
            <img src="img/br.png" class="icono" /> Total: 0
          </div>
        </div>
      </div>
    </div>

    <script>
      const valorReal = document.getElementById("valorReal");
      console.log(`el valor es ${valorReal.value}`);

      /* valorReal.addEventListener("input", (e) => {
        const valor = parseFloat(e.target.value);
        if (isNaN(valor) || valor <= 0) {
          e.target.value = 1;
          alert("El valor debe ser un n√∫mero positivo.");
        }
      }); */
      valorReal.addEventListener("change", (e) => {
        const valor = parseFloat(e.target.value);
        if (isNaN(valor) || valor <= 0) {
          e.target.value = 1;
          alert("El valor debe ser un n√∫mero positivo.");
        }
      });

      let datos = [];

      // Funci√≥n para cargar la tabla
      function cargarTabla() {
        const cuerpo = document.getElementById("cuerpoTabla");
        cuerpo.innerHTML = ""; // Limpiar la tabla antes de recargar
        datos.forEach((item) => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
        <td><input type="checkbox" class="form-check-input selector"></td>
        <td>${item.producto}</td>
        <td><input type="number" class="form-control uy" value="${
          item.precio_uy
        }"></td>
        <td><input type="number" class="form-control br" value="${
          item.precio_br
        }"></td>
        <td class="br-conv fw-bold ">${(
          item.precio_br * valorReal.value
        ).toFixed(2)}</td>
        <td><input type="number" class="form-control cantidad" value="${
          item.cantidad
        }"></td>
      `;
          cuerpo.appendChild(fila);
        });
      }

      // Evento para actualizar la tabla al cambiar el valor de valorReal
      valorReal.addEventListener("change", (e) => {
        const valor = parseFloat(e.target.value);
        if (isNaN(valor) || valor <= 0) {
          e.target.value = 1;
          alert("El valor debe ser un n√∫mero positivo.");
        }
        cargarTabla(); // Recargar la tabla con el nuevo valor
      });

      // Cargar los datos iniciales
      fetch("canasta.json")
        .then((res) => res.json())
        .then((json) => {
          datos = json;
          cargarTabla(); // Cargar la tabla al inicio
        });

      function comparar() {
        const filas = document.querySelectorAll("#tabla tbody tr");
        const valorReal = parseFloat(
          document.getElementById("valorReal").value
        );

        filas.forEach((fila) => {
          const uy = parseFloat(fila.querySelector(".uy").value) || 0;
          const br = parseFloat(fila.querySelector(".br").value) || 0;
          const brEnUy = br * valorReal;

          // Obtener las celdas correspondientes
          const celdaUy = fila.querySelector(".uy");
          const celdaBr = fila.querySelector(".br");

          // Limpiar estilos previos
          celdaUy.style.backgroundColor = "";
          celdaBr.style.backgroundColor = "";

          if (uy < brEnUy) {
            // Resaltar celda de Uruguay
            celdaUy.style.backgroundColor = "#d1e7dd"; // Verde claro
          } else if (brEnUy < uy) {
            // Resaltar celda de Brasil
            celdaBr.style.backgroundColor = "#cff4fc"; // Azul claro
          }
        });
      }
      function calcular() {
        const filas = document.querySelectorAll("#tabla tbody tr");
        let totalUy = 0,
          totalBr = 0;
        filas.forEach((fila) => {
          if (!fila.querySelector(".selector").checked) return;
          const uy = parseFloat(fila.querySelector(".uy").value) || 0;
          const br = parseFloat(fila.querySelector(".br").value) || 0;
          const cantidad =
            parseFloat(fila.querySelector(".cantidad").value) || 1;
          totalUy += uy * cantidad;
          totalBr += br * cantidad;
        });
        document.getElementById(
          "totalUy"
        ).innerHTML = `<img src="img/uy.png" class="icono"> Total compra en Uruguay: ${totalUy.toFixed(
          2
        )}`;
        document.getElementById(
          "totalBr"
        ).innerHTML = `<img src="img/br.png" class="icono"> Totalcompra en Brasil: ${
          totalBr.toFixed(2) * valorReal.value
        }`;
      }
    </script>
  </body>
</html>
