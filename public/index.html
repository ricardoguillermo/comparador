<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Comparador Canasta con Im√°genes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
    
  body {
    background: url('img/fondo.png') no-repeat center center fixed;
    background-size: cover;
    background-attachment: fixed;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }



      th,
      td {
        text-align: center;
        vertical-align: middle;
      }
      .resaltado-uy {
        background-color: #d1e7dd !important;
      }
      .resaltado-br {
        background-color: #cff4fc !important;
      }
      .br-conv {
        font-weight: bold;
        color: blue;
      }

      .mejor-opcion {
        font-size: 1.5rem;
      }

      img.icono {
        width: 24px;
        vertical-align: middle;
      }

      .logo {
        width: 32px;
        margin-right: 8px;
      }
      #valorReal {
      width: 90px; /* Ajusta el ancho seg√∫n sea necesario */
     }

  @media (min-width: 992px) {
  .navbar-collapse {
    display: flex !important;
  }
  .navbar-toggler {
    display: none !important;
  }

  
  

  td input, th, td {
    font-size: 0.85rem;
    padding: 4px;
    min-width: 90px; /* Para que las columnas no colapsen en celulares */
  }

  input.form-control {
    font-size: 0.8rem;
    padding: 2px 4px;
  }

  .accordion-button {
    font-weight: bold;
  }

  footer {
    margin-top: 50px;
    font-size: 0.85rem;
    color: #020f1b;
  }


}
    
  
</style>
    </style>
  </head>

  <body class="bg-light">
    <!-- primero la barra de navegaci√≥n -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      
      Precios en frontera ü§ñ
    </a>
    <!-- Bot√≥n de alternancia (oculto en pantallas grandes) -->
    <button
      class="navbar-toggler d-lg-none"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <!-- Contenedor de los enlaces -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="#idea">La Idea</a></li>
        <li class="nav-item"><a class="nav-link" href="#otras">Otras Yerbas</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin.html">Admin</a></li>
        <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
      </ul>
    </div>
  </div>
</nav>


    <div class="container py-4">
      <h2 class="text-center mb-4">
        üõçÔ∏è  Canasta B√°sica
        <img src="img/uy.png" class="icono" /> vs
        <img src="img/br.png" class="icono" />
      </h2>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <label
            ><strong
              >üí± 1 R$ = $
            </strong></label
          >
          <input
            type="number"
            id="valorReal"
            value="8.00"
            step="0.01"
            maxlength="4"
            class="form-control d-inline "
          />
          <!-- <span class="ms-1"><strong> $</strong></span> -->
        </div>
        <button class="btn bg-success text-white m-2" onclick="cargarTabla(productos)" >Listar </button>
        <div class="col-md-4 m-2">
         
          <input
            type="text"
            id="buscarProducto"
            class="form-control"
            placeholder="üîé Buscar producto..."
          />
        </div>

        <button
          class="btn btn-primary m-2"
          onclick="comparar()"
          data-bs-toggle="tooltip"
          title="Compara los precios para encontrar la mejor opci√≥n"
        >
          üìà Comparar
        </button>
      </div>

      <div class="accordion" id="accordionProductos">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingProductos">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProductos" aria-expanded="true" aria-controls="collapseProductos">
        üõí Ver Productos
      </button>
    </h2>
    <div id="collapseProductos" class="accordion-collapse collapse show" aria-labelledby="headingProductos" data-bs-parent="#accordionProductos">
      <div class="accordion-body">
        <div class="table-responsive">
          <table class="table table-striped table-sm" id="tabla">
            <thead class="table-dark">
              <tr>
                <th>‚úîÔ∏è</th>
                <th>Producto</th>
                <th>Precio üá∫üáæ</th>
                <th>Precio üáßüá∑</th>
                <th>Precio BRL en UY$</th>
                <th>Cantidad</th>
              </tr>
            </thead>
            <tbody id="cuerpoTabla"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

      <div class="text-center mt-3">
        <button class="btn btn-warning" onclick="calcular()" data-bs-toggle="tooltip"
        title="SUMA LOS VALORES ELEGIDOS">
          üßÆ Simular compra
        </button>
      </div>

      <div class="row text-center mt-3">
        <div class="col-md-6">
          <div class="alert alert-success" id="totalUy">
            <img src="img/uy.png" class="icono" /> Total: 0
          </div>
        </div>
        <div class="col-md-6">
          <div class="alert alert-info" id="totalBr">
            <img src="img/br.png" class="icono" /> Total: 0
          </div>
        </div>
      </div>

      <hr>

<!-- Secciones La Idea, Otras Yerbas, Contacto -->
      <section id="idea" class="mt-5">
      
  <h4>üí° La Idea <a href="#" onclick="scrollToTop()">‚¨ÜÔ∏è</a></h4>
  
        <p>
          Vivir cerca de la frontera es un privilegio... y tambi√©n un desaf√≠o.
        </p>
        <p>Quer√≠amos hacer algo con  Inteligencia Artificial y decant√≥ este comparador, cuya idea es ayudar  a encontrar las mejores opciones de compra en Uruguay y Brasil.
          Nuestro amigo IA ü§ñ  reuni√≥ los datos de fuentes oficiales p√∫blicas (Sistema de Informaci√≥n de Precios al Consumidor.-MEF) y conocidos supermercados de frontera. Los precios son promedios ponderados y actualizados en funci√≥n de la informaci√≥n existente.
        </p> 
          <p>
          <span style="font-weight: bold; color: #007bff;"> Se descartaron las super ofertas y precios de liquidaci√≥n, ya que no son representativos del valor habitual.</span> 
          </p>
      </section>

      <hr>

      <section id="otras" class="mt-5">
        <h4>üå± Otras Yerbas <a href="#" onclick="scrollToTop()">‚¨ÜÔ∏è</a>‚Äã</h4>
        <p>
          EL proyecto puede extenderse en el futuro a comparar servicios, impuestos, 
          combustibles, o productos agr√≠colas entre ambos pa√≠ses.
        </p>
      </section>

      <hr>
<!-- contacto -->
      <section id="contacto" class="mt-5">
  <div class="accordion" id="accordionContacto">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingContacto">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContacto" aria-expanded="false" aria-controls="collapseContacto">
          üì¨ Enviar un Comentario
        </button>
      </h2>
      <div id="collapseContacto" class="accordion-collapse collapse" aria-labelledby="headingContacto" data-bs-parent="#accordionContacto">
        <div class="accordion-body">
          <p>Si quer√©s colaborar, sugerir o simplemente comentar, complet√° el siguiente formulario:</p>

          <form id="formularioContacto">
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre:</label>
              <input type="text" class="form-control" id="nombre" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Correo Electr√≥nico:</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
              <label for="comentario" class="form-label">Comentario:</label>
              <textarea class="form-control" id="comentario" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Enviar Comentario</button>
          </form>

          <div id="mensajeExito" class="alert alert-success mt-3 d-none" role="alert">
            ‚úÖ ¬°Gracias! Tu comentario fue enviado correctamente.
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- muestracomentarios -->
<section id="comentarios" class="mt-5">
  <h4>üåü Comentarios Destacados</h4>
  <ul id="listaComentarios" class="list-group"></ul>
</section>

      <!-- pie de p√°gina -->
      <footer class="text-center mt-5 mb-3 text-muted">
              Hecho con compromiso y amistad ü§ù | Artigas - IAü§ñ
          </footer>

      <!-- Modal de bienvenida -->
    <div
      class="modal fade"
      id="bienvenidaModal"
      tabindex="-1"
      aria-labelledby="bienvenidaLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="bienvenidaLabel">¬°Bienvenido!</h5>
          </div>
          <div class="modal-body">
            <p>
              Esta p√°gina recopila precios publicados en fuentes p√∫blicas como
              SIPC, supermercados online y mercados locales. No buscamos
              pol√©micas entre precios de distintos comercios, sino facilitar la
              comparaci√≥n para beneficio de los vecinos.
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              Aceptar
            </button>
          </div>
         </div>
      </div>
    </div>

    </div>


    <script>

document.getElementById('formularioContacto').addEventListener('submit', function(event) {
  event.preventDefault();

  const nombre = document.getElementById('nombre').value.trim();
  const email = document.getElementById('email').value.trim();
  const comentario = document.getElementById('comentario').value.trim();

  if (nombre && email && comentario) {
    fetch('/enviar-comentario', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nombre, email, comentario })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById('formularioContacto').reset();
      document.getElementById('mensajeExito').classList.remove('d-none');
    })
    .catch(err => console.error('Error al enviar comentario:', err));
  }
});


      const valorReal = document.getElementById("valorReal");
      console.log(`el valor es ${valorReal.value}`);

     
      valorReal.addEventListener("change", (e) => {
        const valor = parseFloat(e.target.value);
        if (isNaN(valor) || valor <= 0) {
          e.target.value = 1;
          alert("El valor debe ser un n√∫mero positivo.");
        } else{
          localStorage.setItem("valorReal", valor.toFixed(2));
        }
        cargarTabla(productos); // Recargar la tabla con el nuevo valor
      });

      let productos = [];

      // Funci√≥n para cargar la tabla
      function cargarTabla(productos) {
        const cuerpo = document.getElementById("cuerpoTabla");
        cuerpo.innerHTML = ""; // Limpiar la tabla antes de recargar
        productos.forEach((item) => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
        <td><input type="checkbox" class="form-check-input selector"></td>
        <td>${item.producto.substring(0, 30)}${item.producto.length > 30 ? "..." : ""}</td>
        <td><input type="number" class="form-control uy" value="${
          item.precio_uy
        }"></td>
        <td><input type="number" class="form-control br" value="${
          item.precio_br
        }"></td>
        <td class="br-conv fw-bold ">${(
          item.precio_br * valorReal.value
        ).toFixed(2)}</td>
        <td><input type="number" class="form-control cantidad" value="${
          item.cantidad
        }"></td>
      `;
          cuerpo.appendChild(fila);
        });
      }

      // Evento para actualizar la tabla al cambiar el valor de valorReal
      valorReal.addEventListener("change", (e) => {
        const valor = parseFloat(e.target.value);
        if (isNaN(valor) || valor <= 0) {
          e.target.value = 1;
          alert("El valor debe ser un n√∫mero positivo.");
        }
        cargarTabla(productos); // Recargar la tabla con el nuevo valor
      });

      // Cargar los productos iniciales
      fetch("canasta.json")
        .then((res) => res.json())
        .then((json) => {
         
          productos = json.sort((a, b) =>
            a.producto.localeCompare(b.producto)
          );
          cargarTabla(productos); // Cargar la tabla al inicio
        });

      function comparar() {
        const filas = document.querySelectorAll("#tabla tbody tr");
        const valorReal = parseFloat(
          document.getElementById("valorReal").value
        );

        filas.forEach((fila) => {
          const uy = parseFloat(fila.querySelector(".uy").value) || 0;
          const br = parseFloat(fila.querySelector(".br").value) || 0;
          const brEnUy = br * valorReal;

          // Obtener las celdas correspondientes
          const celdaUy = fila.querySelector(".uy");
          const celdaBr = fila.querySelector(".br");

          // Limpiar estilos previos
          celdaUy.style.backgroundColor = "";
          celdaBr.style.backgroundColor = "";

          if (uy < brEnUy) {
            // Resaltar celda de Uruguay
            celdaUy.style.backgroundColor = "#d1e7dd"; // Verde claro
          } else if (brEnUy < uy) {
            // Resaltar celda de Brasil
            celdaBr.style.backgroundColor = "#cff4fc"; // Azul claro
          }
        });
      }
      function calcular() {
        const filas = document.querySelectorAll("#tabla tbody tr");
        let totalUy = 0,
          totalBr = 0;
        filas.forEach((fila) => {
          if (!fila.querySelector(".selector").checked) return;
          const uy = parseFloat(fila.querySelector(".uy").value) || 0;
          const br = parseFloat(fila.querySelector(".br").value) || 0;
          const cantidad =
            parseFloat(fila.querySelector(".cantidad").value) || 1;
          totalUy += uy * cantidad;
          totalBr += br * cantidad;
        });
      
        // Mostrar totales
        document.getElementById(
          "totalUy"
        ).innerHTML = `<img src="img/uy.png" class="icono"> Total compra en Uruguay: $ ${totalUy.toFixed(2)}`;
       

        // Convertir totalBr a pesos uruguayos
        document.getElementById(
          "totalBr"
        ).innerHTML = `<img src="img/br.png" class="icono"> Total compra en Brasil: $ ${
          totalBr.toFixed(2) * valorReal.value
        }`;
      }


        document
        .getElementById("buscarProducto")
        .addEventListener("input", function (e) {
          const filtro = e.target.value.toLowerCase();
          console.log(filtro);
          const filtrados = productos.filter((p) =>
            p.producto.toLowerCase().includes(filtro)
          );
          cargarTabla(filtrados);
        });

        // Mostrar modal de bienvenida solo la primera vez
      if (!localStorage.getItem("modalMostrado")) {
        var modal = new bootstrap.Modal(
          document.getElementById("bienvenidaModal")
        );
        modal.show();
        localStorage.setItem("modalMostrado", "true");
      }

      // Acceso secreto al admin (ALT + A)
      document.addEventListener("keydown", function (e) {
        if (e.altKey && e.key === "a") {
          window.location.href = "/admin.html";
        }
      });

     
// Cargar comentarios destacados
fetch('/comentarios.json')
  .then(res => res.json())
  .then(data => {
    const comentariosRecientes = data.slice(-5).reverse(); // √∫ltimos 5 comentarios
    const lista = document.getElementById('listaComentarios');
    comentariosRecientes.forEach(com => {
      const li = document.createElement('li');
      li.className = "list-group-item";
      li.textContent = `"${com.comentario}" - ${com.nombre}`;
      lista.appendChild(li);
    });
  });


      
    </script>
  </body>
</html>
